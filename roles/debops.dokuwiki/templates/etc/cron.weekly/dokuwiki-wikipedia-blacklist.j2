#!/bin/bash

# Install current Wikipedia anti-spam blacklist

blacklist="https://meta.wikimedia.org/wiki/Spam_blacklist?action=raw"

if $(type curl > /dev/null 2>&1) ; then
    curl --silent ${blacklist} | grep -v '<pre>' > {{ dokuwiki_git_checkout + "/conf/wordblock.local.conf" }}
{% if dokuwiki_farm_animals is defined and dokuwiki_farm_animals %}

{% for animal in dokuwiki_farm_animals %}
    if [ -d {{ dokuwiki_farm_path + "/" + animal }} ] ; then
        test -h {{ dokuwiki_farm_path + "/" + animal + "/conf/wordblock.local.conf" }} || \
            ln -s {{ dokuwiki_git_checkout + "/conf/wordblock.local.conf" }} \
                  {{ dokuwiki_farm_path + "/" + animal + "/conf/wordblock.local.conf" }}
    fi

{% endfor %}
{% endif %}
fi

